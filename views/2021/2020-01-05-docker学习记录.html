<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker的学习记录 | 小布丁</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <script src="https://unpkg.com/md5/dist/md5.min.js"></script>
    <meta name="description" content="秋天到了，夏天的不甘该通通放下了。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.365e5081.css" as="style"><link rel="preload" href="/assets/js/app.98bd2c8c.js" as="script"><link rel="preload" href="/assets/js/4.742ad0b9.js" as="script"><link rel="preload" href="/assets/js/1.65fad08d.js" as="script"><link rel="preload" href="/assets/js/80.b7f0a264.js" as="script"><link rel="prefetch" href="/assets/js/10.f6eebccc.js"><link rel="prefetch" href="/assets/js/11.9df6fb4c.js"><link rel="prefetch" href="/assets/js/12.90381ab7.js"><link rel="prefetch" href="/assets/js/13.46b72bac.js"><link rel="prefetch" href="/assets/js/14.80ff63cc.js"><link rel="prefetch" href="/assets/js/15.ffd3bd10.js"><link rel="prefetch" href="/assets/js/16.3305b106.js"><link rel="prefetch" href="/assets/js/17.236abf13.js"><link rel="prefetch" href="/assets/js/18.33f9aed8.js"><link rel="prefetch" href="/assets/js/19.bed3f1de.js"><link rel="prefetch" href="/assets/js/20.2f69b534.js"><link rel="prefetch" href="/assets/js/21.bc1f577b.js"><link rel="prefetch" href="/assets/js/22.fc8f5000.js"><link rel="prefetch" href="/assets/js/23.6c37f437.js"><link rel="prefetch" href="/assets/js/24.d32b38f6.js"><link rel="prefetch" href="/assets/js/25.4278685d.js"><link rel="prefetch" href="/assets/js/26.bd5b1f62.js"><link rel="prefetch" href="/assets/js/27.8746c24f.js"><link rel="prefetch" href="/assets/js/28.7027eb7f.js"><link rel="prefetch" href="/assets/js/29.c1f5ca12.js"><link rel="prefetch" href="/assets/js/30.882bdc2e.js"><link rel="prefetch" href="/assets/js/31.b0dbc631.js"><link rel="prefetch" href="/assets/js/32.3e4c319e.js"><link rel="prefetch" href="/assets/js/33.035113a0.js"><link rel="prefetch" href="/assets/js/34.af115c7c.js"><link rel="prefetch" href="/assets/js/35.5ba25331.js"><link rel="prefetch" href="/assets/js/36.9060bbec.js"><link rel="prefetch" href="/assets/js/37.94994779.js"><link rel="prefetch" href="/assets/js/38.896f72a6.js"><link rel="prefetch" href="/assets/js/39.11b686f2.js"><link rel="prefetch" href="/assets/js/40.d51830d4.js"><link rel="prefetch" href="/assets/js/41.8d843107.js"><link rel="prefetch" href="/assets/js/42.a6814857.js"><link rel="prefetch" href="/assets/js/43.5c7484cf.js"><link rel="prefetch" href="/assets/js/44.d7ab80b8.js"><link rel="prefetch" href="/assets/js/45.2529cead.js"><link rel="prefetch" href="/assets/js/46.14a5af47.js"><link rel="prefetch" href="/assets/js/47.6180ccaf.js"><link rel="prefetch" href="/assets/js/48.58630d80.js"><link rel="prefetch" href="/assets/js/49.f7c67d5b.js"><link rel="prefetch" href="/assets/js/5.ef1028d2.js"><link rel="prefetch" href="/assets/js/50.b426e69a.js"><link rel="prefetch" href="/assets/js/51.615404e3.js"><link rel="prefetch" href="/assets/js/52.675213fc.js"><link rel="prefetch" href="/assets/js/53.d1cf8793.js"><link rel="prefetch" href="/assets/js/54.c9ba76dd.js"><link rel="prefetch" href="/assets/js/55.ca3f4439.js"><link rel="prefetch" href="/assets/js/56.3baffb32.js"><link rel="prefetch" href="/assets/js/57.1d678b3c.js"><link rel="prefetch" href="/assets/js/58.761f3176.js"><link rel="prefetch" href="/assets/js/59.1b6c42fb.js"><link rel="prefetch" href="/assets/js/6.10eb616a.js"><link rel="prefetch" href="/assets/js/60.5b7ba898.js"><link rel="prefetch" href="/assets/js/61.aa284528.js"><link rel="prefetch" href="/assets/js/62.7b4a0fee.js"><link rel="prefetch" href="/assets/js/63.d525bffd.js"><link rel="prefetch" href="/assets/js/64.e7255938.js"><link rel="prefetch" href="/assets/js/65.76f2ed6e.js"><link rel="prefetch" href="/assets/js/66.1b77719d.js"><link rel="prefetch" href="/assets/js/67.3a1b8716.js"><link rel="prefetch" href="/assets/js/68.2e7971a7.js"><link rel="prefetch" href="/assets/js/69.e089f42a.js"><link rel="prefetch" href="/assets/js/7.648e1ea0.js"><link rel="prefetch" href="/assets/js/70.935a3bc0.js"><link rel="prefetch" href="/assets/js/71.3117751f.js"><link rel="prefetch" href="/assets/js/72.51211522.js"><link rel="prefetch" href="/assets/js/73.a21f83d8.js"><link rel="prefetch" href="/assets/js/74.a3a6b874.js"><link rel="prefetch" href="/assets/js/75.350c8fb8.js"><link rel="prefetch" href="/assets/js/76.459b24f2.js"><link rel="prefetch" href="/assets/js/77.0c44f94d.js"><link rel="prefetch" href="/assets/js/78.5fa7b545.js"><link rel="prefetch" href="/assets/js/79.273873b0.js"><link rel="prefetch" href="/assets/js/8.384c9cae.js"><link rel="prefetch" href="/assets/js/9.b68091de.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.38f2167c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.365e5081.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>小布丁</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>小布丁</span>
            
          <span data-v-64685f0e>2017 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.jpg" alt="小布丁" class="logo"> <span class="site-name">小布丁</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="iconfont undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具配置/" class="nav-link"><i class="iconfont undefined"></i>
  工具配置
</a></li><li class="dropdown-item"><!----> <a href="/categories/Node/" class="nav-link"><i class="iconfont undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/Shell/" class="nav-link"><i class="iconfont undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/categories/TCP—IP/" class="nav-link"><i class="iconfont undefined"></i>
  TCP—IP
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nginx/" class="nav-link"><i class="iconfont undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/categories/CDN/" class="nav-link"><i class="iconfont undefined"></i>
  CDN
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  Timeline
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Book
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/book/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/book/Node/" class="nav-link"><i class="iconfont undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/book/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zhaohongbo910" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/head.jpg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    小布丁
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>47</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>25</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="iconfont undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具配置/" class="nav-link"><i class="iconfont undefined"></i>
  工具配置
</a></li><li class="dropdown-item"><!----> <a href="/categories/Node/" class="nav-link"><i class="iconfont undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/Shell/" class="nav-link"><i class="iconfont undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/categories/TCP—IP/" class="nav-link"><i class="iconfont undefined"></i>
  TCP—IP
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nginx/" class="nav-link"><i class="iconfont undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/categories/CDN/" class="nav-link"><i class="iconfont undefined"></i>
  CDN
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  Timeline
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Book
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/book/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/book/Node/" class="nav-link"><i class="iconfont undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/book/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zhaohongbo910" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Docker的学习记录</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>小布丁</span>
            
          <span data-v-64685f0e>2017 - </span>
          2021
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>Docker的学习记录</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>小布丁</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2021-01-01</span></i> <!----> <i class="iconfont reco-tag tags" data-v-aa64b9d0><span class="tag-item" data-v-aa64b9d0>Docker</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="docker-诞生的背景"><a href="#docker-诞生的背景" class="header-anchor">#</a> Docker 诞生的背景</h2> <p>主机时代比拼的是单个服务器物理性能（如CPU主频和内存）的强弱，那么在云时代，最为看重的则是凭借虚拟化技术所构建的集群处理能力。
虚拟化的概念早已经广泛应用到各种关键场景中。从20世纪60年代IBM推出的大型主机虚拟化，到后来以Xen、KVM为代表的虚拟机虚拟化，再到现在以Docker为代表的容器技术，虚拟化技术自身也在不断进行创新和突破。
虚拟化既可以通过硬件模拟来实现，也可以通过操作系统软件来实现。而容器技术则更为优雅，它充分利用了操作系统本身已有的机制和特性，可以实现远超传统虚拟机的轻量级虚拟化。因此，有人甚至把它称为“新一代的虚拟化”技术，并将基于容器打造的云平台亲切地称为“容器云”,<strong>Docker正是众多容器技术中的佼佼者</strong></p> <h2 id="初始docker容器"><a href="#初始docker容器" class="header-anchor">#</a> 初始<a href="http://docker.com" target="_blank" rel="noopener noreferrer">Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>容器</h2> <p><strong>Docker是基于Go语言实现的开源容器项目</strong>。它诞生于2013年年初，最初发起者是dotCloud公司(现在已经改为Docker )。Docker项目已加入Linux基金会，并遵循Apache 2.0协议。</p> <h3 id="linux容器技术"><a href="#linux容器技术" class="header-anchor">#</a> Linux容器技术</h3> <p>与大部分新兴技术的诞生一样，Docker也并非“从石头缝里蹦出来的”，而是站在前人的肩膀上，就是Linux容器（Linux Containers, LXC）技术。IBM 开发者网站关于容器技术的描述十分准确：“<strong>容器有效地将由单个操作系统管理的资源划分到孤立的组中，以更好地在孤立的组之间平衡有冲突的资源使用需求。与虚拟化相比，这样既不需要指令级模拟，也不需要即时编译。容器可以在核心CPU本地运行指令，而不需要任何专门的解释机制。此外，也避免了准虚拟化（para-virtualization）和系统调用替换中的复杂性</strong>。LXC也经历了长期的演化，最早可以追溯到1982年Unix系列操作系统上的chroot工具。</p> <h3 id="从linux容器到docker"><a href="#从linux容器到docker" class="header-anchor">#</a> 从Linux容器到Docker</h3> <p>在LXC的基础上，Docker进一步优化了容器的使用体验，<strong>首先，Docker提供了各种容器管理工具（如分发、版本、移植等），让用户无须关注底层的操作，更加简单明了地管理和使用容器；其次，Docker通过引入分层文件系统构建和高效的镜像机制，降低了迁移难度，极大地改善了用户体验。用户操作Docker容器就像操作应用自身一样简单。</strong>
早期的Docker代码实现是直接基于LXC的。自0.9版本开始，Docker开发了libcon-tainer项目作为更广泛的容器驱动实现，从而替换掉了LXC的实现。目前，Docker还积极推动成立了runC标准项目，并贡献给开放容器联盟，试图让容器的支持不再局限于Linux操作系统，而是更安全、更开放、更具扩展性。简单地讲。
Docker容器理解为一种轻量级的沙盒（sandbox）。每个容器内运行着一个或多个应用，不同的容器相互隔离，容器之间也可以通过网络互相通信。<strong>容器的创建和停止十分快速，几乎跟创建和终止原生应用一致；另外，容器自身对系统资源的额外需求也十分有限，远远低于传统虚拟机。很多时候，甚至直接把容器当作应用本身也没有任何问题。</strong></p> <h3 id="docker的目标"><a href="#docker的目标" class="header-anchor">#</a> Docker的目标</h3> <p>Docker的构想是要实现“Build, Ship and Run Any App, Anywhere”，即通过对应用的封装（Packaging）、分发（Distribution）、部署（Deployment）、运行（Runtime）全生命周期进行管理，达到应用组件级别的“一次封装，到处运行”。这里的应用组件，既可以是一个Web应用、一个编译环境，也可以是一套数据库平台服务，甚至是一个操作系统或集群。</p> <h2 id="docker引擎的认识"><a href="#docker引擎的认识" class="header-anchor">#</a> Docker引擎的认识</h2> <p>Docker 引擎由如下主要的组件构成：
Docker 客户端（Docker Client）
Docker 守护进程（Docker daemon）
containerd 以及 runc。它们共同负责容器的创建和运行
最新的架构示意图：</p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/1024167/1610590030318-7cfc76cf-4e83-4ba8-89ab-1cc9c8e9fd09.png#align=left&amp;display=inline&amp;height=708&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=944&amp;originWidth=1419&amp;size=541017&amp;status=done&amp;style=stroke&amp;width=1064" alt="image.png"></p> <h2 id="核心概念与安装配置"><a href="#核心概念与安装配置" class="header-anchor">#</a> 核心概念与安装配置</h2> <p>介绍Docker的三大核心概念：❑ 镜像（Image）❑ 容器（Container）❑ 仓库（Repository）只有理解了这三个核心概念，才能顺利地理解Docker容器的整个生命周期。</p> <h3 id="镜像"><a href="#镜像" class="header-anchor">#</a> 镜像</h3> <p>Docker镜像类似于虚拟机镜像，可以将它理解为一个只读的模板。例如，一个镜像可以包含一个基本的操作系统环境，里面仅安装了Apache应用程序（或用户需要的其他软件）。可以把它称为一个Apache镜像。镜像是创建Docker容器的基础。通过版本管理和增量的文件系统，Docker提供了一套十分简单的机制来创建和更新现有的镜像，用户甚至可以从网上下载一个已经做好的应用镜像，并直接使用。镜像可以理解成源代码。</p> <h3 id="容器"><a href="#容器" class="header-anchor">#</a> 容器</h3> <p><strong>Docker容器类似于一个轻量级的沙箱</strong>，Docker利用容器来运行和隔离应用。容器是从镜像创建的应用运行实例。它可以启动、开始、停止、删除，而这些容器都是彼此相互隔离、互不可见的。可以把容器看作一个简易版的Linux系统环境（包括root用户权限、进程空间、用户空间和网络空间等）以及运行在其中的应用程序打包而成的盒子。容器可以理解成从镜像编译运行的应用程序。</p> <h3 id="仓库"><a href="#仓库" class="header-anchor">#</a> 仓库</h3> <p>镜像仓库，则是指存放镜像文件的地方，可以理解成源代码仓库，列如GitHub，或者GitLab。
每个仓库集中存放某一类镜像，往往包括多个镜像文件，通过不同的标签（tag）来进行区分。例如存放Ubuntu操作系统镜像的仓库，被称为Ubuntu仓库，其中可能包括16.04、18.04等不同版本的镜像。
目前，最大的公开仓库是官方提供的<a href="https://registry.hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，其中存放着数量庞大的镜像供用户下载。国内不少云服务提供商<a href="https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.3e221b118dxyXs" target="_blank" rel="noopener noreferrer">阿里云仓库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>也提供了仓库的本地源，可以提供稳定的国内访问。</p> <h3 id="docker的安装"><a href="#docker的安装" class="header-anchor">#</a> <a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener noreferrer">Docker的安装 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Docker引擎目前分为两个版本：**社区版本（Community Edition, CE）和企业版本（Enterprise Edition, EE）。**对于windows和 Mac 版本的Docker 都是社区提供的，在生产环境中不建议使用。所以重点学习在其Linux系统的上面的使用，以centos8为例安装学习：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> -e  <span class="token string">'卸载旧版本的docker'</span>
yum remove docker <span class="token punctuation">\</span>
                  docker-client <span class="token punctuation">\</span>
                  docker-client-latest <span class="token punctuation">\</span>
                  docker-common <span class="token punctuation">\</span>
                  docker-latest <span class="token punctuation">\</span>
                  docker-latest-logrotate <span class="token punctuation">\</span>
                  docker-logrotate <span class="token punctuation">\</span>
                  docker-engine
<span class="token builtin class-name">echo</span> -e <span class="token string">'安装常用软件包'</span>
yum <span class="token function">install</span> yum-utils device-mapper-persistent-data lvm2 -y
<span class="token builtin class-name">echo</span> -e <span class="token string">'添加 阿里Docker源'</span>
yum-config-manager  --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="token builtin class-name">echo</span> <span class="token string">'更新并安装Docker-CE'</span>
<span class="token function">sudo</span> yum makecache fast
<span class="token builtin class-name">echo</span> -e <span class="token string">'安装docker-ce'</span>
yum <span class="token function">install</span> -y docker-ce docker-ce-cli containerd.io
<span class="token builtin class-name">echo</span> -e <span class="token string">'设置Docker开机自启动'</span>
systemctl <span class="token builtin class-name">enable</span> docker
<span class="token builtin class-name">echo</span> -e <span class="token string">'启动docker'</span>
systemctl start docker
<span class="token builtin class-name">echo</span> -e <span class="token string">'查看docker版本'</span>
docker --version
<span class="token builtin class-name">echo</span> -e <span class="token string">'给docker换阿里源'</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/docker/daemon.json</span>
{
&quot;registry-mirrors&quot;: [&quot;https://fl791z1h.mirror.aliyuncs.com&quot;]
}
EOF</span>
<span class="token builtin class-name">echo</span> -e <span class="token string">'重启docker服务'</span>
systemctl restart docker

<span class="token builtin class-name">echo</span> -e <span class="token string">'查看docker信息'</span>
docker info
<span class="token builtin class-name">exit</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>安装过程出现的可能出现的问题排查： 由于最新的docker 依赖的container 的版本变化引起的安装问题</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># yum -y install docker-ce</span>
上次元数据过期检查：0:00:32 前，执行于 <span class="token number">2021</span>年01月07日 星期四 08时07分56秒。
错误：
 问题: package docker-ce-3:20.10.2-3.el7.x86_64 requires containerd.io <span class="token operator">&gt;</span><span class="token operator">=</span> <span class="token number">1.4</span>.1, but none of the providers can be installed
  - cannot <span class="token function">install</span> the best candidate <span class="token keyword">for</span> the job
  - package containerd.io-1.4.3-3.1.el7.x86_64 is filtered out by modular filtering

<span class="token comment"># 出现上面的错误信息的时候 ，打开下面的链接 找到对应的 centos 版本，然后点进去找到继续找 下图所</span>
https://mirrors.aliyun.com/docker-ce/linux/centos/

<span class="token function">wget</span> https://mirrors.aliyun.com/docker-ce/linux/centos/8/x86_64/stable/Packages/containerd.io-1.4.3-3.1.el8.x86_64.rpm

yum <span class="token function">install</span> containerd.io-1.4.3-3.1.el8.x86_64.rpm

<span class="token comment"># 在继续</span>
yum -y <span class="token function">install</span> docker-ce 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1024167/1610590030441-75cc67e4-5624-4e47-945c-ee21c57a65f3.png#align=left&amp;display=inline&amp;height=432&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=864&amp;originWidth=1962&amp;size=977051&amp;status=done&amp;style=none&amp;width=981" alt="image.png"></p> <h2 id="镜像-image"><a href="#镜像-image" class="header-anchor">#</a> 镜像 image</h2> <h4 id="docker-image-pull-或者-docker-pull"><a href="#docker-image-pull-或者-docker-pull" class="header-anchor">#</a> <code>docker image pull</code> 或者 <code>docker pull</code></h4> <p>镜像是运行容器的前提,可以使用<code>docker [image] pull</code>命令直接从Docker Hub镜像源来下载镜像。该命令的格式为 <code>docker [image] pull NAME[:TAG]</code> NAME是镜像仓库名称（用来区分镜像）, TAG是镜像的标签（往往用来表示版本信息）。通常情况下，描述一个镜像需要包括“名称+标签”信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker pull centos   获取一个镜像，不加 tag 标签的时候 默认拉去的 tag是latest</span>
Using default tag: latest
latest: Pulling from library/centos
7a0437f04f83: Pull complete
Digest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1
Status: Downloaded newer image <span class="token keyword">for</span> centos:latest
docker.io/library/centos:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>下载过程中可以看出，镜像文件一般由若干层（layer）组成，7a0437f04f83这样的串是层的唯一id（实际上完整的id包括256比特，64个十六进制字符组成）。使用docker pull命令下载中会获取并输出镜像的各层信息。当不同的镜像包括相同的层时，本地仅存储了层的一份内容，减小了存储空间</p> <h4 id="docker-images命令可以列出本地主机上已有镜像的基本信息"><a href="#docker-images命令可以列出本地主机上已有镜像的基本信息" class="header-anchor">#</a> <code>docker images</code><strong>命令可以列出本地主机上已有镜像的基本信息</strong></h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY            TAG       IMAGE ID       CREATED         SIZE
nginx                 latest    ae2feff98a0c   <span class="token number">3</span> weeks ago     133MB
centos                latest    300e315adb2f   <span class="token number">4</span> weeks ago     209MB
portainer/portainer   latest    62771b0b9b09   <span class="token number">5</span> months ago    <span class="token number">79</span>.1MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看到几个字段信息：
❑ 来自于哪个仓库，比如centos表示centos系列的基础镜像；
❑ 镜像的标签信息，比如latest表示不同的版本信息。标签只是标记，并不能标识镜像内容；
❑ 镜像的ID（唯一标识镜像），如果两个镜像的ID相同，说明它们实际上指向了同一个镜像，只是具有不同标签名称而已；
❑ 创建时间，说明镜像最后的更新时间；
❑ 镜像大小，优秀的镜像往往体积都较小</p> <h4 id="docker-image-inspect-镜像名称-镜像id-命令可以获取该镜像的详细信息-包括制作者、适应架构、各层的数字摘要等"><a href="#docker-image-inspect-镜像名称-镜像id-命令可以获取该镜像的详细信息-包括制作者、适应架构、各层的数字摘要等" class="header-anchor">#</a> <code>docker[image]inspect 镜像名称/镜像ID</code>  命令可以获取该镜像的详细信息，包括制作者、适应架构、各层的数字摘要等</h4> <h4 id="docker-history-镜像名称-镜像id命令查看镜像历史"><a href="#docker-history-镜像名称-镜像id命令查看镜像历史" class="header-anchor">#</a> <code>docker history 镜像名称/镜像ID</code>命令查看镜像历史</h4> <h4 id="docker-search-镜像名称-命令可以搜索docker-hub官方仓库中的镜像"><a href="#docker-search-镜像名称-命令可以搜索docker-hub官方仓库中的镜像" class="header-anchor">#</a> <code>docker search 镜像名称</code> 命令可以搜索Docker Hub官方仓库中的镜像</h4> <h4 id="docker-rmi-镜像名称-镜像id或docker-image-rm-镜像名称-镜像id命令删除镜像"><a href="#docker-rmi-镜像名称-镜像id或docker-image-rm-镜像名称-镜像id命令删除镜像" class="header-anchor">#</a> <code>docker rmi 镜像名称/镜像ID</code>或<code>docker image rm 镜像名称/镜像ID</code>命令删除镜像</h4> <h4 id="docker-image-prune命令来进行清理镜像"><a href="#docker-image-prune命令来进行清理镜像" class="header-anchor">#</a> <code>docker image prune</code>命令来进行清理镜像</h4> <p>使用Docker一段时间后，系统中可能会遗留一些临时的镜像文件，以及一些没有被使用的镜像可以使用上述的命令清理掉
支持选项包括：
❑ -a, -all：删除所有无用镜像，不光是临时镜像
❑ -filter filter：只清理符合给定过滤器的镜像
❑ -f, -force：强制删除镜像，而不进行提示确认</p> <h4 id="docker-container-commit命令基于已有容器创建镜像"><a href="#docker-container-commit命令基于已有容器创建镜像" class="header-anchor">#</a> <code>docker [container] commit</code>命令基于已有容器创建镜像</h4> <p>命令格式为 docker [container] commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]
主要选项包括：OPTIONS
<strong>❑ -a, --author=&quot;&quot;：作者信息</strong> <strong>❑ -c, --change=[]：提交的时候执行Dockerfile指令，包括CMD|ENTRYPOINT|ENV|EXPOSE|LABEL|ONBUILD|USER|VOLUME|WORKDIR等</strong> <strong>❑ -m, --message=&quot;&quot;：提交消息</strong> <strong>❑ -p, --pause=true：提交时暂停容器运行</strong></p> <h4 id="docker-container-import-从模板文件导入一个镜像"><a href="#docker-container-import-从模板文件导入一个镜像" class="header-anchor">#</a> <code>docker [container] import</code> 从模板文件导入一个镜像</h4> <p>命令格式为 docker [image] import [OPTIONS]file|URL|-[REPOSITORY [:TAG]]</p> <h4 id="基于dockerfile创建镜像"><a href="#基于dockerfile创建镜像" class="header-anchor">#</a> 基于Dockerfile创建镜像</h4> <h4 id="docker-image-save-导出镜像到本地文件"><a href="#docker-image-save-导出镜像到本地文件" class="header-anchor">#</a> <code>docker [image] save</code> 导出镜像到本地文件</h4> <p>该命令支持-o、-output string参数，导出镜像到指定的文件中，就可以通过复制到处的文件给别人使用</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>// 保存当前的centos 镜像为centos_letest.tar 文件
docker save -o centon_letest.tar centos:latest  

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="docker-image-load将导出的tar文件再导入到本地镜像库"><a href="#docker-image-load将导出的tar文件再导入到本地镜像库" class="header-anchor">#</a> <code>docker [image] load</code>将导出的tar文件再导入到本地镜像库</h4> <p>支持-i、-input string选项，从指定文件中读入镜像内容</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> docker load -i centon_letest.tar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="docker-image-push-命令上传镜像到仓库"><a href="#docker-image-push-命令上传镜像到仓库" class="header-anchor">#</a> <code>docker [image] push</code> 命令上传镜像到仓库</h4> <p>默认上传到Docker Hub官方仓库,类似 <code>git push</code></p> <h2 id="容器-container"><a href="#容器-container" class="header-anchor">#</a> 容器 container</h2> <p>容器是Docker的另一个核心概念。简单来说，容器是镜像的一个运行实例。所不同的是，镜像是静态的只读文件，而容器带有运行时需要的可写文件层，同时，容器中的应用进程处于运行状态。</p> <h3 id="创建容器"><a href="#创建容器" class="header-anchor">#</a> 创建容器</h3> <h4 id="docker-container-create命令新建一个容器"><a href="#docker-container-create命令新建一个容器" class="header-anchor">#</a> <code>docker [container] create</code>命令新建一个容器</h4> <p>使用docker [container] create命令新建的容器处于停止状态，可以使用 <code>docker[container] start</code>命令来启动它。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker create -it centos:latest</span>
27a89a80a2cb4e5c5fe0e24ef86cb2dac451219beeee3f11ac916fe2143f369a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="docker-container-start启动容器"><a href="#docker-container-start启动容器" class="header-anchor">#</a> <code>docker [container] start</code>启动容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker start 27a89a80a2c</span>
27a89a80a2c
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS      NAMES
27a89a80a2cb   centos:latest         <span class="token string">&quot;/bin/bash&quot;</span>              <span class="token number">6</span> minutes ago   Up <span class="token number">4</span> seconds              objective_lederberg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="docker-container-run新建并启动容器"><a href="#docker-container-run新建并启动容器" class="header-anchor">#</a> <code>docker [container] run</code>新建并启动容器</h4> <p>等价于先执行<code>docker [container]create</code>命令，再执行<code>docker [container] start</code>命令
当利用docker [container] run来创建并启动容器时，Docker在后台运行的标准操作包括：
❑ 检查本地是否存在指定的镜像，不存在就从公有仓库下载
❑ 利用镜像创建一个容器，并启动该容器
❑ 分配一个文件系统给容器，并在只读的镜像层外面挂载一层可读写层
❑ 从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去
❑ 从网桥的地址池配置一个IP地址给容器
❑ 执行用户指定的应用程序
❑ 执行完毕后容器被自动终止</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run -it --name centos-test  centos:latest /bin/bash</span>
<span class="token punctuation">[</span>root@d078291e042a /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>常用选项</p> <ul><li>**-t **选项让Docker分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上，</li> <li>**-i **则让容器的标准输入保持打开</li> <li><strong>--name</strong> 给这个启动的容器起一个名称</li> <li><strong>-d</strong> 需要让Docker容器在后台以守护态（Daemonized）形式运行</li> <li>更多的命令选项可以通过 docker run --help命令来查看</li></ul> <h4 id="docker-container-logs-查看容器输出日志"><a href="#docker-container-logs-查看容器输出日志" class="header-anchor">#</a> <code>docker [container] logs</code> 查看容器输出日志</h4> <h3 id="停止容器"><a href="#停止容器" class="header-anchor">#</a> 停止容器</h3> <h4 id="docker-container-pause-命令来暂停一个运行中的容器"><a href="#docker-container-pause-命令来暂停一个运行中的容器" class="header-anchor">#</a> <code>docker [container] pause</code> 命令来暂停一个运行中的容器</h4> <p>处于paused状态的容器，可以使用<code>docker [container] unpause</code> CONTAINER[CONTAINER...]命令来恢复到运行状态</p> <h4 id="docker-container-unpause命令来恢复到运行状态"><a href="#docker-container-unpause命令来恢复到运行状态" class="header-anchor">#</a> <code>docker [container] unpause命令来恢复到运行状态</code></h4> <h4 id="docker-container-stop来终止一个运行中的容器"><a href="#docker-container-stop来终止一个运行中的容器" class="header-anchor">#</a> <code>docker [container] stop</code>来终止一个运行中的容器</h4> <p>该命令会首先向容器发送SIGTERM信号，等待一段超时时间后（默认为10秒），再发送SIGKILL信号来终止容器，处于终止状态的容器，可以通过<code>docker [container] start</code>命令来重新启动</p> <h4 id="docker-container-kill直接发送sigkill信号来强行终止容器"><a href="#docker-container-kill直接发送sigkill信号来强行终止容器" class="header-anchor">#</a> <code>docker [container] kill</code>直接发送SIGKILL信号来强行终止容器</h4> <h4 id="docker-container-restart命令会将一个运行态的容器先终止-然后再重新启动"><a href="#docker-container-restart命令会将一个运行态的容器先终止-然后再重新启动" class="header-anchor">#</a> <code>docker [container] restart</code>命令会将一个运行态的容器先终止，然后再重新启动</h4> <h3 id="进入容器"><a href="#进入容器" class="header-anchor">#</a> 进入容器</h3> <h4 id="docker-container-attach-连接到正在运行中的容器"><a href="#docker-container-attach-连接到正在运行中的容器" class="header-anchor">#</a> <code>docker [container] attach</code> 连接到正在运行中的容器</h4> <h4 id="docker-container-exec-更加方便的工具exec命令-可以在运行中容器内直接执行任意命令"><a href="#docker-container-exec-更加方便的工具exec命令-可以在运行中容器内直接执行任意命令" class="header-anchor">#</a> <code>docker [container] exec</code> 更加方便的工具exec命令，可以在运行中容器内直接执行任意命令</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it 容器名称/容器ID /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="删除容器"><a href="#删除容器" class="header-anchor">#</a> 删除容器</h3> <h4 id="docker-container-rm命令来删除处于终止或退出状态的容器"><a href="#docker-container-rm命令来删除处于终止或退出状态的容器" class="header-anchor">#</a> <code>docker [container] rm</code>命令来删除处于终止或退出状态的容器</h4> <p>主要支持的选项包括：
❑ -f, --force=false：是否强行终止并删除一个运行中的容器
❑ -l, --link=false：删除容器的连接，但保留容器
❑ -v, --volumes=false：删除容器挂载的数据卷</p> <h3 id="导入和导出容器"><a href="#导入和导出容器" class="header-anchor">#</a> 导入和导出容器</h3> <h4 id="docker-container-export"><a href="#docker-container-export" class="header-anchor">#</a> <code>docker [container] export</code></h4> <p>导出容器是指，导出一个已经创建的容器到一个文件，不管此时这个容器是否处于运行状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">export</span> -o export_centos.tar 容器ID/容器名称
// -o 导出的文件名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="docker-container-import命令导入变成镜像"><a href="#docker-container-import命令导入变成镜像" class="header-anchor">#</a> <code>docker [container] import</code>命令导入变成镜像</h4> <h4 id="docker-container-inspect-查看容器详情"><a href="#docker-container-inspect-查看容器详情" class="header-anchor">#</a> <code>docker container inspect</code> 查看容器详情</h4> <h4 id="docker-container-top查看容器内进程"><a href="#docker-container-top查看容器内进程" class="header-anchor">#</a> <code>docker [container] top</code>查看容器内进程</h4> <h4 id="docker-container-stats-查看统计信息"><a href="#docker-container-stats-查看统计信息" class="header-anchor">#</a> <code>docker [container] stats</code> 查看统计信息</h4> <h4 id="docker-container-cp-命令支持在容器和主机之间复制文件"><a href="#docker-container-cp-命令支持在容器和主机之间复制文件" class="header-anchor">#</a> <code>docker [container] cp</code> 命令支持在容器和主机之间复制文件</h4> <p>本地的路径data复制到test容器的/tmp路径下 <code>docker cp data test:/tmp</code></p> <h4 id="docker-container-diff-查看容器内文件系统的变更"><a href="#docker-container-diff-查看容器内文件系统的变更" class="header-anchor">#</a> <code>docker [container] diff</code> 查看容器内文件系统的变更</h4> <h4 id="docker-container-port命令可以查看容器的端口映射情况"><a href="#docker-container-port命令可以查看容器的端口映射情况" class="header-anchor">#</a> <code>docker [container] port</code>命令可以查看容器的端口映射情况</h4> <h4 id="docker-container-update-命令可以更新容器的一些运行时配置-主要是一些资源限制份额"><a href="#docker-container-update-命令可以更新容器的一些运行时配置-主要是一些资源限制份额" class="header-anchor">#</a> <code>docker [container] update</code> 命令可以更新容器的一些运行时配置，主要是一些资源限制份额</h4> <p>支持的选项包括：
❑ -blkio-weight uint16：更新块IO限制，10～1000，默认值为0，代表着无限制
❑ -cpu-period int：限制CPU调度器CFS（Completely Fair Scheduler）使用时间，单位为微秒，最小1000
❑ -cpu-quota int：限制CPU调度器CFS配额，单位为微秒，最小1000
❑ -cpu-rt-period int：限制CPU调度器的实时周期，单位为微秒
❑ -cpu-rt-runtime int：限制CPU调度器的实时运行时，单位为微秒
❑ -c, -cpu-shares int：限制CPU使用份额；
❑ -cpus decimal：限制CPU个数；
❑ -cpuset-cpus string：允许使用的CPU核，如0-3,0,1
❑ -cpuset-mems string：允许使用的内存块，如0-3,0,1
❑ -kernel-memory bytes：限制使用的内核内存；
❑ -m, -memory bytes：限制使用的内存
❑ -memory-reservation bytes：内存软限制
❑ -memory-swap bytes：内存加上缓存区的限制，-1表示为对缓冲区无限制
❑ -restart string：容器退出后的重启策略</p> <h2 id="docker数据管理"><a href="#docker数据管理" class="header-anchor">#</a> Docker数据管理</h2> <p>在生产环境中使用Docker，往往需要对数据进行持久化，或者需要在多个容器之间进行数据共享，这必然涉及容器的数据管理操作。
容器中的管理数据主要有两种方式：
<strong>❑ 数据卷（Data Volumes）：容器内数据直接映射到本地主机环境；</strong> <strong>❑ 数据卷容器（Data Volume Containers）：使用特定容器维护数据卷。</strong>
首先介绍如何在容器内创建数据卷，并且把本地的目录或文件挂载到容器内的数据卷中。其次介绍如何使用数据卷容器在容器和主机、容器和容器之间共享数据，并实现数据的备份和恢复。</p> <h3 id="数据卷"><a href="#数据卷" class="header-anchor">#</a> 数据卷</h3> <p><strong>数据卷（Data Volumes）是一个可供容器使用的特殊目录，它将主机操作系统目录直接映射进容器，类似于Linux中的mount行为</strong>
数据卷可以提供很多有用的特性：
❑ 数据卷可以在容器之间共享和重用，容器间传递数据将变得高效与方便
❑ 对数据卷内数据的修改会立马生效，无论是容器内操作还是本地操作
❑ 对数据卷的更新不会影响镜像，解耦开应用和数据
❑ 卷会一直存在，直到没有容器使用，可以安全地卸载它</p> <h3 id="创建数据卷"><a href="#创建数据卷" class="header-anchor">#</a> 创建数据卷</h3> <h4 id="docker-volume-create-创建数据卷"><a href="#docker-volume-create-创建数据卷" class="header-anchor">#</a> <code>docker volume create</code> 创建数据卷</h4> <p>Docker提供了volume子命令来管理数据卷，如下命令可以快速在本地创建一个数据卷：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker volume create -d <span class="token builtin class-name">local</span> test-vol 创建一个本地的数据卷
// 
/var/lib/docker/volumes路径下，会发现所创建的数据卷 test-vol
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="docker-volume-inspect-查看详细信息"><a href="#docker-volume-inspect-查看详细信息" class="header-anchor">#</a> <code>docker volume inspect</code>（查看详细信息）</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost volumes<span class="token punctuation">]</span><span class="token comment"># docker volume inspect test-vol</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-01-07T16:36:32-05:00&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/test-vol/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test-vol&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="docker-volume-ls-列出已有数据卷"><a href="#docker-volume-ls-列出已有数据卷" class="header-anchor">#</a> <code>docker volume ``ls</code> 列出已有数据卷</h4> <h4 id="docker-volume-prune-清理无用数据卷"><a href="#docker-volume-prune-清理无用数据卷" class="header-anchor">#</a> <code>docker volume prune</code> 清理无用数据卷</h4> <h4 id="docker-volume-rm-删除数据卷"><a href="#docker-volume-rm-删除数据卷" class="header-anchor">#</a> <code>docker volume rm</code> 删除数据卷</h4> <h3 id="绑定数据卷"><a href="#绑定数据卷" class="header-anchor">#</a> 绑定数据卷</h3> <p><strong>除了使用volume子命令来管理数据卷外，还可以在创建容器时将主机本地的任意路径挂载到容器内作为数据卷，这种形式创建的数据卷称为绑定数据卷</strong> <code>docker [container] run</code>命令的时候，可以使用**-mount**选项来使用数据卷。
-mount type选项支持三种类型的数据卷，包括：
❑ volume：普通数据卷，映射到主机/var/lib/docker/volumes路径下；
❑ bind：绑定数据卷，映射到主机指定路径下；
❑ tmpfs：临时数据卷，只存在于内存中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>source：主机目录路径
destination:容器目录路径

<span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/path/on/host,destination<span class="token operator">=</span>/path/in/container

<span class="token assign-left variable">type</span><span class="token operator">=</span>volume,source<span class="token operator">=</span>my-volume,destination<span class="token operator">=</span>/path/in/container,volume-label<span class="token operator">=</span><span class="token string">&quot;color=red&quot;</span>,volume-label<span class="token operator">=</span><span class="token string">&quot;shape=round&quot;</span>

<span class="token assign-left variable">type</span><span class="token operator">=</span>tmpfs,tmpfs-size<span class="token operator">=</span>512M,destination<span class="token operator">=</span>/path/in/container
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -itd --name centos-test --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/www,destination<span class="token operator">=</span>/cen_www centos:latest
// 上面的命令相当下面
docker run -itd --name centos-test  -v /www:/cen_www centos:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Docker挂载数据卷的默认权限是读写（rw），用户也可以通过ro指定为只读：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -itd --name centos-test  -v /www:/cen_www:ro centos:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="数据卷容器"><a href="#数据卷容器" class="header-anchor">#</a> 数据卷容器</h3> <p>如果需要在多个容器之间共享一些持续更新的数据，最简单的方式是使用数据卷容器。<strong>数据卷容器也是一个容器，但是它的目的是专门提供数据卷给其他容器挂载</strong>
首先，创建一个数据卷容器dbcontainer，并在其中创建一个数据卷挂载到/dbcontainer,
然后，可以在其他容器中使用 **--volumes-from **来挂载dbcontainer容器中的数据卷，例如创建db1和db2两个容器，并从dbcontainer容器挂载数据卷：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -itd --name dbcontainer -v /db_host:/dbdata centos:latest
docker run -itd --name db1  --volumes-from   dbcontainer centos:latest
docker run -itd --name  db2  --volumes-from  dbcontainer centos:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此时，容器db1和db2都挂载同一个数据卷到相同的/dbdata目录，三个容器任何一方在该目录下的写入，其他容器都可以看到
可以多次使用 --volumes-from 参数来从多个容器挂载多个数据卷，还可以从其他已经挂载了容器卷的容器来挂载数据卷</p> <h2 id="端口映射与容器互联"><a href="#端口映射与容器互联" class="header-anchor">#</a> 端口映射与容器互联</h2> <p>Docker除了通过网络访问外，还提供了两个很方便的功能来满足服务访问的基本需求：一个是允许映射容器内应用的服务端口到本地宿主主机；另一个是互联机制实现多个容器间通过容器名来快速访问</p> <h3 id="从外部访问容器应用"><a href="#从外部访问容器应用" class="header-anchor">#</a> 从外部访问容器应用</h3> <p>当容器中运行一些网络应用，要让外部访问这些应用时，可以通过-P或-p参数来指定端口映射。
当使用-P（大写的）标记时，Docker会随机映射一个49000～49900的端口到内部容器开放的网络端口
-p（小写的）则可以指定要映射的端口，并且，在一个指定端口上只可以绑定一个容器。
支持的格式有</p> <ul><li>**映射所有接口地址 **</li></ul> <p><code>HostPort:ContainerPort</code>       ** eg:80   8080:8080**</p> <ul><li><strong>映射到指定地址的指定端口</strong></li></ul> <p><code>IP:HostPort:ContainerPort</code> ** eg:127.0.0.1:5000:5000**</p> <ul><li><strong>映射到指定地址的任意端口</strong></li></ul> <p><code>IP::ContainerPort</code> <strong>eg:127.0.0.1::5000</strong>
使用<code>IP::ContainerPort</code>绑定localhost的任意端口到容器的5000端口，本地主机会自动分配一个端口</p> <ul><li><strong>指定udp端口</strong></li></ul> <p><code>IP:ContainerPort/udp</code> <strong>eg:127.0.0.1:5000/udp</strong></p> <h3 id="容器互联"><a href="#容器互联" class="header-anchor">#</a> 容器互联</h3> <p>使用--link参数可以让容器之间安全地进行交互 ，--link参数的格式为--link name:alias，其中name是要链接的容器的名称，alias是别名</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>// 先创建一个容器
docker run -it --rm --name centos-1 centos:latest
// 在创建一个容器
docker run -itd --name centos-2 --link centos-1:centos-1 centos:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Docker相当于在两个互联的容器之间创建了一个虚机通道，而且不用映射它们的端口到宿主主机上。</strong> <strong>在启动容器的时候并没有使用-p和-P标记，从而避免了暴露数据库服务端口到外部网络上。</strong> <strong>Docker通过两种方式为容器公开连接信息：</strong>
❑ **更新环境变量  **
查看容器的环境变量 ：<code>docker exec centos-1 env</code> 使用env命令来查看容器的环境变量
❑ <strong>更新/etc/hosts文件</strong></p> <h2 id="使用dockerfile创建镜像"><a href="#使用dockerfile创建镜像" class="header-anchor">#</a> 使用Dockerfile创建镜像</h2> <p>Dockerfile是一个文本格式的配置文件，用户可以使用Dockerfile来快速创建自定义的镜像。
Dockerfile由一行行命令语句组成，并且支持以#开头的注释行。
一般而言，<strong>Dockerfile主体内容分为四部分：基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令</strong></p> <h4 id="配置指令说明"><a href="#配置指令说明" class="header-anchor">#</a> 配置指令说明</h4> <p>Dockerfile中指令的一般格式为<code>INSTRUCTION arguments</code>，包括“<strong>配置指令</strong>”（配置镜像信息）和“<strong>操作指令</strong>”</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token keyword">ARG</span>     		定义创建镜像过程中使用的变量 唯一一个可以在FROM指令之前
<span class="token keyword">FROM</span>    		指定基础镜像，必须为第一个命令（在没有ARG)
<span class="token keyword">LABEL</span> 			LABEL指令可以为生成的镜像添加元数据标签信息。这些信息可以用来辅助过滤出特定镜像
<span class="token keyword">EXPOSE</span> 			声明镜像内服务监听的端口
<span class="token keyword">ENV</span>    			指定环境变量，在镜像生成过程中会被后续RUN指令使用，在镜像启动的容器中也会存在
<span class="token keyword">ENTRYPOINT</span> 	指定镜像的默认入口命令，该入口命令会在启动容器时作为根命令执行，所有传入值作为该命令的参数
<span class="token keyword">VOLUME</span> 			创建一个数据卷挂载点
<span class="token keyword">USER</span>				指定运行容器时的用户名或UID，后续的RUN等指令也会使用指定的用户身份
<span class="token keyword">WORKDIR</span> 		为后续的RUN、CMD、ENTRYPOINT指令配置工作目录
<span class="token keyword">ONBUILD</span> 		指定当基于所生成镜像创建子镜像时，自动执行的操作指令
<span class="token keyword">STOPSIGNAL</span> 	指定所创建镜像启动的容器接收退出的信号值
<span class="token keyword">HEALTHCHECK</span> 配置所启动容器如何进行健康检查
<span class="token keyword">SHELL</span> 			指定其他命令使用shell时的默认shell类型
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="操作指令"><a href="#操作指令" class="header-anchor">#</a> 操作指令</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token keyword">RUN</span> 	运行指定命令
<span class="token keyword">CMD</span>		用来指定启动容器时默认执行的命令
<span class="token keyword">ADD</span>		添加内容到镜像
<span class="token keyword">COPY</span>	复制内容到镜像
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id=""><a href="#" class="header-anchor">#</a></h3> <h3 id="常用指令"><a href="#常用指令" class="header-anchor">#</a> 常用指令</h3> <h4 id="arg-定义创建镜像过程中使用的变量"><a href="#arg-定义创建镜像过程中使用的变量" class="header-anchor">#</a> <code>ARG</code> : 定义创建镜像过程中使用的变量</h4> <p><strong>唯一一个可以在FROM指令之前的指令,ARG指令定义的参数，在docker build命令中以--build-arg a_name=a_value形式赋值。如果docker build命令传递的参数，在Dockerfile中没有对应的参数，将警告</strong></p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 格式：</span>
    <span class="token keyword">ARG</span> &lt;name<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>=&lt;default value<span class="token punctuation">&gt;</span><span class="token punctuation">]</span>
<span class="token comment"># 示例：</span>
    <span class="token keyword">ARG</span> VERSION=<span class="token string">&quot;7.0&quot;</span>
    <span class="token keyword">FROM</span> centos<span class="token punctuation">:</span>$<span class="token punctuation">{</span>VERSION<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="from-指定所创建镜像的基础镜像"><a href="#from-指定所创建镜像的基础镜像" class="header-anchor">#</a> <code>FROM</code> : 指定所创建镜像的基础镜像</h4> <p><strong>tag或digest是可选的，如果不使用这两个值时，会使用latest版本的基础镜像</strong></p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 格式：</span>
    <span class="token keyword">FROM</span> &lt;image<span class="token punctuation">&gt;</span>
    <span class="token keyword">FROM</span> &lt;image<span class="token punctuation">&gt;</span><span class="token punctuation">:</span>&lt;tag<span class="token punctuation">&gt;</span>
    <span class="token keyword">FROM</span> &lt;image<span class="token punctuation">&gt;</span>@&lt;digest<span class="token punctuation">&gt;</span>
 <span class="token comment">#示例：　　</span>
    <span class="token keyword">FROM</span> mysql<span class="token punctuation">:</span>5.6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="label-指令可以为生成的镜像添加元数据标签信息"><a href="#label-指令可以为生成的镜像添加元数据标签信息" class="header-anchor">#</a> <code>LABEL</code> : 指令可以为生成的镜像添加元数据标签信息</h4> <p><strong>使用LABEL指定元数据时，一条LABEL指定可以指定一或多条元数据，指定多条元数据时不同元数据之间通过空格分隔。推荐将所有的元数据通过一条LABEL指令指定，以免生成过多的中间镜像</strong></p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 格式：</span>
    <span class="token keyword">LABEL</span> &lt;key<span class="token punctuation">&gt;</span>=&lt;value<span class="token punctuation">&gt;</span> &lt;key<span class="token punctuation">&gt;</span>=&lt;value<span class="token punctuation">&gt;</span> &lt;key<span class="token punctuation">&gt;</span>=&lt;value<span class="token punctuation">&gt;</span> <span class="token punctuation">...</span>
<span class="token comment"># 示例：</span>
    <span class="token keyword">LABEL</span> version=<span class="token string">&quot;1.0&quot;</span> description=<span class="token string">&quot;这是一个Web服务器&quot;</span> by=<span class="token string">&quot;IT笔录&quot;</span>
    <span class="token keyword">LABEL</span> author=<span class="token string">&quot;sun@qq.com&quot;</span> data=<span class="token string">&quot;2021-1-1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="expose-声明镜像内服务监听的端口"><a href="#expose-声明镜像内服务监听的端口" class="header-anchor">#</a> <code>EXPOSE</code> : 声明镜像内服务监听的端口</h4> <p><strong>EXPOSE并不会让容器的端口访问到主机。要使其可访问，需要在docker run运行容器时通过-p来发布这些端口，或通过-P参数来发布EXPOSE导出的所有端口</strong></p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 格式：</span>
    <span class="token keyword">EXPOSE</span> &lt;port<span class="token punctuation">&gt;</span> <span class="token punctuation">[</span>&lt;port<span class="token punctuation">&gt;</span><span class="token punctuation">...</span><span class="token punctuation">]</span>
<span class="token comment"># 示例：</span>
    <span class="token keyword">EXPOSE</span> 80 443
    <span class="token keyword">EXPOSE</span> 8080    EXPOSE 11211/tcp 11211/udp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="env-指定环境变量"><a href="#env-指定环境变量" class="header-anchor">#</a> <code>ENV</code> : 指定环境变量</h4> <p><strong>指令指定的环境变量在运行时可以被覆盖掉，如 <code>docker run --env &lt;key&gt;=&lt;value&gt; built_image</code></strong></p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">#格式：</span>
    <span class="token keyword">ENV</span> &lt;key<span class="token punctuation">&gt;</span> &lt;value<span class="token punctuation">&gt;</span>  <span class="token comment">#&lt;key&gt;之后的所有内容均会被视为其&lt;value&gt;的组成部分，因此，一次只能设置一个变量</span>
    <span class="token keyword">ENV</span> &lt;key<span class="token punctuation">&gt;</span>=&lt;value<span class="token punctuation">&gt;</span> <span class="token punctuation">...</span>  <span class="token comment">#可以设置多个变量，每个变量为一个&quot;&lt;key&gt;=&lt;value&gt;&quot;的键值对，如果&lt;key&gt;中包含空格，可以使用\来进行转义，也可以通过&quot;&quot;来进行标示；另外，反斜线也可以用于续行</span>
<span class="token comment"># 示例：</span>
    <span class="token keyword">ENV</span> myName John Doe
    <span class="token keyword">ENV</span> myDog Rex The Dog
    <span class="token keyword">ENV</span> myCat=fluffy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="entrypoint-指定镜像的默认入口命令"><a href="#entrypoint-指定镜像的默认入口命令" class="header-anchor">#</a> <code>ENTRYPOINT</code>: 指定镜像的默认入口命令</h4> <p><strong>注ENTRYPOINT与CMD非常类似，不同的是通过docker run执行的命令不会覆盖ENTRYPOINT，而docker run命令中指定的任何参数，都会被当做参数再次传递给ENTRYPOINT。Dockerfile中只允许有一个ENTRYPOINT命令，多指定时会覆盖前面的设置，而只执行最后的ENTRYPOINT指令,在运行时，可以被--entrypoint参数覆盖掉，如 docker run --entrypoint</strong></p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">#格式：</span>
    <span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;executable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param2&quot;</span><span class="token punctuation">]</span> (可执行文件<span class="token punctuation">,</span> 优先)
    <span class="token keyword">ENTRYPOINT</span> command param1 param2 (shell内部命令)
示例：
    <span class="token keyword">FROM</span> ubuntu
    <span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-b&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="volume-创建一个数据卷挂载点"><a href="#volume-创建一个数据卷挂载点" class="header-anchor">#</a> <code>VOLUME</code> :创建一个数据卷挂载点</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 格式：</span>
    <span class="token keyword">VOLUME</span> <span class="token punctuation">[</span><span class="token string">&quot;/path/to/dir&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># 示例：</span>
    <span class="token keyword">VOLUME</span> <span class="token punctuation">[</span><span class="token string">&quot;/data&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">VOLUME</span> <span class="token punctuation">[</span><span class="token string">&quot;/var/www&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/var/log/apache2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/etc/apache2&quot;</span>

注：一个卷可以存在于一个或多个容器的指定目录，该目录可以绕过联合文件系统，并具有以下功能：
1 卷可以容器间共享和重用
2 容器并不一定要和其它容器共享卷
3 修改卷后会立即生效
4 对卷的修改不会对镜像产生影响
5 卷会一直存在，直到没有任何容器在使用它
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="user-指定运行容器时的用户名或uid"><a href="#user-指定运行容器时的用户名或uid" class="header-anchor">#</a> <code>USER</code> : 指定运行容器时的用户名或UID</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 格式:　　</span>
    <span class="token keyword">USER</span> <span class="token keyword">user</span>　　
    <span class="token keyword">USER</span> user<span class="token punctuation">:</span>group　　
    <span class="token keyword">USER</span> uid　　
    <span class="token keyword">USER</span> uid<span class="token punctuation">:</span>gid　　
    <span class="token keyword">USER</span> user<span class="token punctuation">:</span>gid　　
    <span class="token keyword">USER</span> uid<span class="token punctuation">:</span>group 
<span class="token comment"># 示例：    　　</span>
		<span class="token keyword">USER</span> www 
<span class="token comment"># 注：使用USER指定用户后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT都将使用该用户。镜像构建完成后，通过docker run运行容器时，可以通过-u参数来覆盖所指定的用户。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>WORKDIR 为后续的RUN、CMD、ENTRYPOINT指令配置工作目录，通过WORKDIR设置工作目录后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT、ADD、COPY 等命令都会在该目录下执行。在使用</strong><code>** docker run -w **</code>**运行容器时，可以通过-w参数覆盖构建时所设置的工作目录 **</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># 格式：</span>
		<span class="token keyword">WORKDIR</span> /path/to/workdir
<span class="token comment"># 示例：</span>
    <span class="token keyword">WORKDIR</span> /a  (这时工作目录为/a)
    <span class="token keyword">WORKDIR</span> b  (这时工作目录为/a/b)
    <span class="token keyword">WORKDIR</span> c  (这时工作目录为/a/b/c)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="onbuild-指定当基于所生成镜像创建子镜像时-自动执行的操作指令"><a href="#onbuild-指定当基于所生成镜像创建子镜像时-自动执行的操作指令" class="header-anchor">#</a> <code>ONBUILD</code> : 指定当基于所生成镜像创建子镜像时，自动执行的操作指令</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">#格式：　</span>
		<span class="token keyword">ONBUILD</span> <span class="token punctuation">[</span>INSTRUCTION<span class="token punctuation">]</span>
<span class="token comment">#示例：</span>
　　<span class="token keyword">ONBUILD</span> <span class="token keyword">ADD</span> . /app/src
　　<span class="token keyword">ONBUILD</span> <span class="token keyword">RUN</span> /usr/local/bin/python<span class="token punctuation">-</span>build <span class="token punctuation">-</span><span class="token punctuation">-</span>dir /app/src
<span class="token comment"># 注：当所构建的镜像被用做其它镜像的基础镜像，该镜像中的触发器将会被钥触发</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="run-运行指定命令"><a href="#run-运行指定命令" class="header-anchor">#</a> <code>RUN</code>： 运行指定命令</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>RUN用于在镜像容器中执行命令，其有以下两种命令执行方式：
shell执行
格式：
    <span class="token keyword">RUN</span> &lt;command<span class="token punctuation">&gt;</span>
    
exec执行
格式：
    <span class="token keyword">RUN</span> <span class="token punctuation">[</span><span class="token string">&quot;executable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param2&quot;</span><span class="token punctuation">]</span>
    
示例：
    <span class="token keyword">RUN</span> <span class="token punctuation">[</span><span class="token string">&quot;executable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param2&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">RUN</span> apk update
    <span class="token keyword">RUN</span> <span class="token punctuation">[</span><span class="token string">&quot;/etc/execfile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arg1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arg1&quot;</span><span class="token punctuation">]</span>
注：RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定<span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache参数，如：docker build <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="cmd-指令用来指定启动容器时默认执行的命令"><a href="#cmd-指令用来指定启动容器时默认执行的命令" class="header-anchor">#</a> <code>CMD</code> ： 指令用来指定启动容器时默认执行的命令</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>格式：
    <span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;executable&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;param1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;param2&quot;</span><span class="token punctuation">]</span> (执行可执行文件，优先)
    <span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;param1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;param2&quot;</span><span class="token punctuation">]</span> (设置了ENTRYPOINT，则直接调用ENTRYPOINT添加参数)
    <span class="token keyword">CMD</span> command param1 param2 (执行shell内部命令)
示例：
    <span class="token keyword">CMD</span> echo <span class="token string">&quot;This is a test.&quot;</span> <span class="token punctuation">|</span> wc <span class="token punctuation">-</span>
    <span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/bin/wc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;--help&quot;</span><span class="token punctuation">]</span>
    
 注： CMD不同于RUN，CMD用于指定在容器启动时所要执行的命令，而RUN用于指定镜像构建时所要执行的命令。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="add-添加内容到镜像"><a href="#add-添加内容到镜像" class="header-anchor">#</a> <code>ADD</code>：添加内容到镜像</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>格式：
    <span class="token keyword">ADD</span> &lt;src<span class="token punctuation">&gt;</span><span class="token punctuation">...</span> &lt;dest<span class="token punctuation">&gt;</span>
    <span class="token keyword">ADD</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;src&gt;&quot;</span><span class="token punctuation">,</span><span class="token punctuation">...</span> <span class="token string">&quot;&lt;dest&gt;&quot;</span><span class="token punctuation">]</span> 用于支持包含空格的路径
示例：
    <span class="token keyword">ADD</span> hom* /mydir/          <span class="token comment"># 添加所有以&quot;hom&quot;开头的文件</span>
    <span class="token keyword">ADD</span> hom<span class="token punctuation">?</span>.txt /mydir/      <span class="token comment"># ? 替代一个单字符,例如：&quot;home.txt&quot;</span>
    <span class="token keyword">ADD</span> test relativeDir/     <span class="token comment"># 添加 &quot;test&quot; 到 `WORKDIR`/relativeDir/</span>
    <span class="token keyword">ADD</span> test /absoluteDir/    <span class="token comment"># 添加 &quot;test&quot; 到 /absoluteDir/</span>
   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="copy-复制内容到镜像"><a href="#copy-复制内容到镜像" class="header-anchor">#</a> <code>COPY</code>：复制内容到镜像</h4> <p><strong>COPY与ADD指令功能类似，但是是不会自动解压文件，也不能访问网络资源，当使用本地目录为源目录时，推荐使用COPY</strong>
下载 nginx-1.18.0.tar.gz ，epel-release-latest-7.noarch.rpm 文件在同一目录之下
并且在当前目录下 新建 Dockerfile 文件</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># This nginx Dockerfile</span>
<span class="token comment"># Version 1.0</span>

<span class="token comment"># Base images 基础镜像</span>
<span class="token keyword">FROM</span> centos

<span class="token comment">#MAINTAINER 维护者信息</span>
<span class="token keyword">MAINTAINER</span> sunwukong 

<span class="token comment">#ENV 设置环境变量</span>
<span class="token keyword">ENV</span> PATH /usr/local/nginx/sbin<span class="token punctuation">:</span>$PATH

<span class="token comment">#ADD  文件放在当前目录下，拷过去会自动解压</span>
<span class="token keyword">ADD</span> ./nginx<span class="token punctuation">-</span>1.18.0.tar.gz /usr/local/  
<span class="token keyword">ADD</span> ./epel<span class="token punctuation">-</span>release<span class="token punctuation">-</span>latest<span class="token punctuation">-</span>7.noarch.rpm /usr/local/  

<span class="token comment">#RUN 执行以下命令 </span>
<span class="token keyword">RUN</span> rpm <span class="token punctuation">-</span>ivh /usr/local/epel<span class="token punctuation">-</span>release<span class="token punctuation">-</span>latest<span class="token punctuation">-</span>7.noarch.rpm
<span class="token keyword">RUN</span> yum install <span class="token punctuation">-</span>y wget lftp gcc gcc<span class="token punctuation">-</span>c++ make openssl<span class="token punctuation">-</span>devel pcre<span class="token punctuation">-</span>devel pcre &amp;&amp; yum clean all
<span class="token keyword">RUN</span> useradd <span class="token punctuation">-</span>s /sbin/nologin <span class="token punctuation">-</span>M www

<span class="token comment">#WORKDIR 相当于cd</span>
<span class="token keyword">WORKDIR</span> /usr/local/nginx<span class="token punctuation">-</span>1.8.0 

<span class="token keyword">RUN</span> ./configure <span class="token punctuation">-</span><span class="token punctuation">-</span>prefix=/usr/local/nginx <span class="token punctuation">-</span><span class="token punctuation">-</span>user=www <span class="token punctuation">-</span><span class="token punctuation">-</span>group=www <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>http_ssl_module <span class="token punctuation">-</span><span class="token punctuation">-</span>with<span class="token punctuation">-</span>pcre &amp;&amp; make &amp;&amp; make install

<span class="token keyword">RUN</span> echo <span class="token string">&quot;daemon off;&quot;</span> <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> /etc/nginx.conf

<span class="token comment">#EXPOSE 映射端口</span>
<span class="token keyword">EXPOSE</span> 80

<span class="token comment">#CMD 运行以下命令</span>
<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;nginx&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="dockerfile构建镜像"><a href="#dockerfile构建镜像" class="header-anchor">#</a> Dockerfile构建镜像</h3> <p><code>docker build -t Name:Tag -f Dockerfile .</code> 构建镜像
**</p> <table><thead><tr><th style="text-align:left;">--add-host list</th> <th style="text-align:left;">添加自定义Host到ip的映射（主机:ip）</th></tr></thead> <tbody><tr><td style="text-align:left;">--build-arg list</td> <td style="text-align:left;">设置构建时的变量</td></tr> <tr><td style="text-align:left;">--cache-from strings</td> <td style="text-align:left;">将镜像视为缓存源</td></tr> <tr><td style="text-align:left;">--cgroup-parent string</td> <td style="text-align:left;">可选的容器父cgroup</td></tr> <tr><td style="text-align:left;">--compress</td> <td style="text-align:left;">使用gzip工具压缩构建的上下文</td></tr> <tr><td style="text-align:left;">--console</td> <td style="text-align:left;">显示控制台输出，仅使用 buildkit，参数有：true、false、auto（默认为 auto）</td></tr> <tr><td style="text-align:left;">--cpu-period int</td> <td style="text-align:left;">限制CPU CFS（完全公平的调度）的周期</td></tr> <tr><td style="text-align:left;">--cpu-quota int</td> <td style="text-align:left;">限制CPU CFS（完全公平的调度）的限额</td></tr> <tr><td style="text-align:left;">-c, --cpu-shares int</td> <td style="text-align:left;">设置CUP的共享权重</td></tr> <tr><td style="text-align:left;">--cpuset-cpus string</td> <td style="text-align:left;">允许执行的cpu个数 （0-3,0,1）</td></tr> <tr><td style="text-align:left;">--cpuset-mems string</td> <td style="text-align:left;">允许执行的MEM个数 （0-3,0,1）</td></tr> <tr><td style="text-align:left;">--disable-content-trust</td> <td style="text-align:left;">跳过镜像的验证（默认为 true）</td></tr> <tr><td style="text-align:left;">-f, --file string</td> <td style="text-align:left;">构建的Dockerfile的名称（默认为 ‘PATH/Dockerfile’）</td></tr> <tr><td style="text-align:left;">--force-rm</td> <td style="text-align:left;">总是移除中间容器</td></tr> <tr><td style="text-align:left;">--iidfile string</td> <td style="text-align:left;">将镜像ID写入到指定文件</td></tr> <tr><td style="text-align:left;">--isolation string</td> <td style="text-align:left;">容器隔离技术</td></tr> <tr><td style="text-align:left;">--label list</td> <td style="text-align:left;">为镜像设置元数据</td></tr> <tr><td style="text-align:left;">-m, --memory bytes</td> <td style="text-align:left;">内存限额</td></tr> <tr><td style="text-align:left;">--memory-swap bytes</td> <td style="text-align:left;">如果启用无限交换，则交换限制等于内存加上交换:'-1'即可</td></tr> <tr><td style="text-align:left;">--network string</td> <td style="text-align:left;">在构建期间为 RUN 指令设置网络模式（默认为 “default”）</td></tr> <tr><td style="text-align:left;">--no-cache</td> <td style="text-align:left;">在构建映像时不使用缓存（设定后，每次都会重新去拉取，默认使用缓存的）</td></tr> <tr><td style="text-align:left;">--platform string</td> <td style="text-align:left;">如果服务器具有多平台能力，则设置该平台</td></tr> <tr><td style="text-align:left;">--pull</td> <td style="text-align:left;">总是尝试拉取该镜像的新版本</td></tr> <tr><td style="text-align:left;">-q, --quiet</td> <td style="text-align:left;">镜像构建成功后禁止生成输出和打印镜像的ID</td></tr> <tr><td style="text-align:left;">--rm</td> <td style="text-align:left;">构建成功后删除中间容器（默认为 true）</td></tr> <tr><td style="text-align:left;">--security-opt strings</td> <td style="text-align:left;">安全选项</td></tr> <tr><td style="text-align:left;">--shm-size bytes</td> <td style="text-align:left;">设定/dev/shm的大小</td></tr> <tr><td style="text-align:left;">--squash</td> <td style="text-align:left;">将新建的镜像层压缩成一个新的镜像层</td></tr> <tr><td style="text-align:left;">--stream</td> <td style="text-align:left;">将流附加到服务器以协商构建上下文</td></tr> <tr><td style="text-align:left;">-t, --tag list</td> <td style="text-align:left;">名称和可选的标签（格式为 'name:tag' ）</td></tr> <tr><td style="text-align:left;">--target string</td> <td style="text-align:left;">设置需要构建的目标构建阶段</td></tr> <tr><td style="text-align:left;">--ulimit ulimit</td> <td style="text-align:left;">U 限制项 (默认为 [])</td></tr></tbody></table> <p>**</p> <h2 id="docker-网络"><a href="#docker-网络" class="header-anchor">#</a> Docker 网络</h2> <p>默认情况下容器与容器、容器与宿主机的网络是隔离开来的,docker 网络需要解决的就是 容器于容器的之间的互通。</p> <h3 id="网络模式"><a href="#网络模式" class="header-anchor">#</a> 网络模式</h3> <table><thead><tr><th>Docker网络模式</th> <th>配置</th> <th>说明</th></tr></thead> <tbody><tr><td>host模式</td> <td>--net=host</td> <td>容器和宿主机共享Network namespace</td></tr> <tr><td>container模式</td> <td>--net=container:NAME_or_ID</td> <td>容器和另外一个容器共享Network namespace，kubernetes中的pod就是多个容器共享一个Network namespace</td></tr> <tr><td>none模式</td> <td>--net=none</td> <td>容器有独立的Network namespace,</td></tr> <tr><td>但并没有对其进行任何网络设置，如分配veth pair 和网桥连接，配置IP等</td> <td></td> <td></td></tr> <tr><td>bridge模式</td> <td>--net=bridge （默认为该模式）</td> <td>网络桥接模式，将自动生成独有的Network namespace</td></tr> <tr><td>自定义模式</td> <td>--net=自定义网络名称</td> <td></td></tr></tbody></table> <h3 id="host模式"><a href="#host模式" class="header-anchor">#</a> host模式</h3> <p>原理：如果启动容器的时候使用host模式，<strong>那么这个容器将不会获得一个独立的Network Namespace，而是和宿主机共用一个Network Namespace</strong>。<strong>容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口</strong>。但是，<strong>容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。</strong> <strong>使用host模式的容器可以直接使用宿主机的IP地址与外界通信，容器内部的服务端口也可以使用宿主机的端口，不需要进行NAT</strong>，<strong>host最大的优势就是网络性能比较好，但是docker host上已经使用的端口就不能再用了，网络的隔离性不好。</strong>
**
<strong><img src="https://cdn.nlark.com/yuque/0/2021/png/1024167/1610590030647-7f1f8a08-da68-4027-8bd1-c11c6aa61abe.png#align=left&amp;display=inline&amp;height=589&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1178&amp;originWidth=1746&amp;size=296255&amp;status=done&amp;style=stroke&amp;width=873" alt="image.png"></strong>
**</p> <h3 id="container模式"><a href="#container模式" class="header-anchor">#</a> container模式</h3> <p>这个模式指定新创建的容器和已经存在的一个容器共享一个 Network Namespace，而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。两个容器的进程可以通过 lo 网卡设备通信</p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/1024167/1610590030813-bcecebc1-6d24-46db-9125-e3475dfa87f2.png#align=left&amp;display=inline&amp;height=568&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1136&amp;originWidth=1910&amp;size=292388&amp;status=done&amp;style=stroke&amp;width=955" alt="image.png"></p> <h3 id="none模式"><a href="#none模式" class="header-anchor">#</a> none模式</h3> <p>使用none模式，Docker容器拥有自己的Network Namespace，但是，并不为Docker容器进行任何网络配置。也就是说，这个Docker容器没有网卡、IP、路由等信息。需要我们自己为Docker容器添加网卡、配置IP等。
这种网络模式下容器只有lo回环网络，没有其他网卡。none模式可以在容器创建时通过--network=none来指定。这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性
<img src="https://cdn.nlark.com/yuque/0/2021/png/1024167/1610590030993-15476566-7ebc-4978-92a1-6275249db5ba.png#align=left&amp;display=inline&amp;height=535&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1070&amp;originWidth=1852&amp;size=245458&amp;status=done&amp;style=stroke&amp;width=926" alt="image.png"></p> <h3 id="bridge模式"><a href="#bridge模式" class="header-anchor">#</a> bridge模式</h3> <p>当Docker进程启动时，会在主机上创建一个名为<code>docker0</code>的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中
从<code>docker0</code>子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关。在主机上创建一对虚拟网卡<code>veth pair</code>设备，Docker将veth pair设备的一端放在新创建的容器中，并命名为eth0（容器的网卡），另一端放在主机中，以vethxxx这样类似的名字命名，并将这个网络设备加入到docker0网桥中。可以通过<code>brctl show</code>命令查看
bridge模式是docker的默认网络模式，不写--net参数，就是bridge模式。使用<code>docker run -p</code>时，docker实际是在iptables做了NAT规则，实现端口转发功能。可以使用<code>iptables -t nat -vnL</code>查看</p> <p><code>veth-pair</code>就是一对的虚拟设备接口，它都是成对出现的。一端连着协议栈，一端彼此相连着</p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/1024167/1610590031155-ac887d2d-818e-4f7c-847e-e93dfd5466a9.png#align=left&amp;display=inline&amp;height=513&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1026&amp;originWidth=1856&amp;size=317257&amp;status=done&amp;style=stroke&amp;width=928" alt="image.png"></p> <h4 id="bridge模存在的问题"><a href="#bridge模存在的问题" class="header-anchor">#</a> bridge模存在的问题</h4> <p>按照以下方式创建了两个容器，在通过名称互联访问时候，连接不用</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -itd  --name centos-bdg-01 centos:latest
docker run -itd  --name centos-bdg-02 centos:latest

// 会出现以下问题
docker <span class="token builtin class-name">exec</span> -it centos-bdg-01 <span class="token function">ping</span> centos-bdg-02
ping: centos-bdg-02: Name or <span class="token function">service</span> not known
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="自定义模式"><a href="#自定义模式" class="header-anchor">#</a> 自定义模式</h3> <h4 id="docker-network-ls列出本地网络模式"><a href="#docker-network-ls列出本地网络模式" class="header-anchor">#</a> <code>docker network ls</code>列出本地网络模式</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker network <span class="token function">ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
63d9493bce38   bridge    bridge    <span class="token builtin class-name">local</span>      <span class="token comment"># 桥接模式</span>
de1105dfa5a8   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>			<span class="token comment"># host模式</span>
87441a7540aa   none      null      <span class="token builtin class-name">local</span> 			<span class="token comment"># none模式</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="docker-network-create-创建一个网络模式"><a href="#docker-network-create-创建一个网络模式" class="header-anchor">#</a> <code>docker network create</code>     创建一个网络模式</h4> <ul><li><strong>--driver 连接的网络模式</strong></li> <li>**--subnet 子网掩码 192.168.0.0/16 **</li> <li><strong>--gateway 192.168.1.0 网关</strong></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker network create --driver bridge  --subnet <span class="token number">192.168</span>.0.0/16  --gateway <span class="token number">192.168</span>.1.0 mynet

336cdb202d7a5d7f1fb3f8dc087d5d6e1b7aa46b3513186c8cb35bc1125a0784
docker network <span class="token function">ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
63d9493bce38   bridge    bridge    <span class="token builtin class-name">local</span>
de1105dfa5a8   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
336cdb202d7a   mynet     bridge    <span class="token builtin class-name">local</span>
87441a7540aa   none      null      <span class="token builtin class-name">local</span>


创建自定义模式的docker容器
docker run -itd  --name centos-net-01 --network mynet centos:latest
docker run -itd  --name centos-net-02 --network mynet centos:latest

再次执行 可以发现容器之间是互通的
docker <span class="token builtin class-name">exec</span> -it centos-net-01 <span class="token function">ping</span> centos-net-02
PING centos-net-02 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from centos-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.096</span> ms
<span class="token number">64</span> bytes from centos-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.162</span> ms
<span class="token number">64</span> bytes from centos-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.160</span> ms
<span class="token number">64</span> bytes from centos-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.181</span> ms
<span class="token number">64</span> bytes from centos-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">5</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.158</span> ms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="docker-network-inspect-显示一个或多个网络上的详细信息"><a href="#docker-network-inspect-显示一个或多个网络上的详细信息" class="header-anchor">#</a> <code>docker network inspect</code>    显示一个或多个网络上的详细信息</h4> <h4 id="docker-network-connect-将容器连接到网络"><a href="#docker-network-connect-将容器连接到网络" class="header-anchor">#</a> <code>docker network connect</code>  将容器连接到网络</h4> <p><code>docker network connect [OPTIONS] NETWORK CONTAINER</code>
目前环境中有一下几个容器
<strong>centos-bdg-xx 走原始的桥接模式的 docker0 网卡 网段实在 172.17.0.0/16</strong> <strong>centos-net-xx 走的是自定义的mynet模式的 mynet网卡 网段 在 192.168.0.0/16</strong></p> <p>怎么实现 centos-bdg-xx 到  centos-net-- 的通信</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token function">ps</span>
CONTAINER ID   IMAGE           COMMAND       CREATED          STATUS          PORTS     NAMES
1573b7088604   centos:latest   <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">6</span> minutes ago    Up <span class="token number">6</span> minutes              centos-net-02
22a4f34fb7b8   centos:latest   <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">6</span> minutes ago    Up <span class="token number">6</span> minutes              centos-net-01
22844f330ba3   centos:latest   <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">25</span> minutes ago   Up <span class="token number">25</span> minutes             centos-bdg-02
8f7ae3be00e3   centos:latest   <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">25</span> minutes ago   Up <span class="token number">25</span> minutes             centos-bdg-01


docker network connect mynet centos-bdg-01
docker <span class="token builtin class-name">exec</span> -it centos-bdg-01  <span class="token function">ping</span> centos-net-01
PING centos-net-01 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.1<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from centos-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.095</span> ms
<span class="token number">64</span> bytes from centos-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.161</span> ms
<span class="token number">64</span> bytes from centos-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.202</span> ms
<span class="token number">64</span> bytes from centos-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.153</span> ms


docker network inspect mynet
····
<span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;1573b70886040ce5922a0366e866bd6c5ac91acd851dd53dd43b2c2fbc388389&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;centos-net-02&quot;</span>,
      <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;968dd40f23362c3066df4092a2be6955c8681eaf38e07e505344492bc383a8c9&quot;</span>,
      <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:00:02&quot;</span>,
      <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.2/16&quot;</span>,
      <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;22a4f34fb7b8becd82719d16cecf84c54ca48bc184964042aecec74d18d1c931&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;centos-net-01&quot;</span>,
      <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;b2c7cf4d66fdeeea5559bd81fd3166bf78e0e3064e5016e71e51ba5543c5ded4&quot;</span>,
      <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:00:01&quot;</span>,
      <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.1/16&quot;</span>,
      <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">}</span>,
      // 容器连接到自定义网卡中
      <span class="token string">&quot;8f7ae3be00e349005326d1fd4ff57fd0e19867b66a23bbc73c9568c9467b7c6f&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;centos-bdg-01&quot;</span>,
      <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;22427d81dc7386d04c7502ae90c99b812503e8514a13c1e89207435a2ec9ebb4&quot;</span>,
      <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:00:03&quot;</span>,
      <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.3/16&quot;</span>,
      <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1024167/1610590031354-0ca2af1d-4cfd-4ac7-96e8-21894df04e70.png#align=left&amp;display=inline&amp;height=636&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1272&amp;originWidth=2334&amp;size=530914&amp;status=done&amp;style=stroke&amp;width=1167" alt="image.png"></p> <h4 id="docker-network-rm-移除一个网络模式"><a href="#docker-network-rm-移除一个网络模式" class="header-anchor">#</a> <code>docker network rm</code>  移除一个网络模式</h4> <h4 id="docker-network-prune-删除所有未使用的网络"><a href="#docker-network-prune-删除所有未使用的网络" class="header-anchor">#</a> <code>docker network prune</code> 删除所有未使用的网络</h4> <p>**</p> <h2 id="docker-可视化管理"><a href="#docker-可视化管理" class="header-anchor">#</a> Docker 可视化管理</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -itd --restart always --name portainer-web -p <span class="token number">9000</span>:9000  -v /var/run/docker.sock:/var/run/docker.sock  portainer/portainer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/22/2021, 7:27:01 AM</span></div></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#docker-诞生的背景" class="sidebar-link" data-v-40a3448a>Docker 诞生的背景</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#初始docker容器" class="sidebar-link" data-v-40a3448a>初始Docker容器</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#linux容器技术" class="sidebar-link" data-v-40a3448a>Linux容器技术</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#从linux容器到docker" class="sidebar-link" data-v-40a3448a>从Linux容器到Docker</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#docker的目标" class="sidebar-link" data-v-40a3448a>Docker的目标</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#docker引擎的认识" class="sidebar-link" data-v-40a3448a>Docker引擎的认识</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#核心概念与安装配置" class="sidebar-link" data-v-40a3448a>核心概念与安装配置</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#镜像" class="sidebar-link" data-v-40a3448a>镜像</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#容器" class="sidebar-link" data-v-40a3448a>容器</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#仓库" class="sidebar-link" data-v-40a3448a>仓库</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#docker的安装" class="sidebar-link" data-v-40a3448a>Docker的安装</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#镜像-image" class="sidebar-link" data-v-40a3448a>镜像 image</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#容器-container" class="sidebar-link" data-v-40a3448a>容器 container</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#创建容器" class="sidebar-link" data-v-40a3448a>创建容器</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#停止容器" class="sidebar-link" data-v-40a3448a>停止容器</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#进入容器" class="sidebar-link" data-v-40a3448a>进入容器</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#删除容器" class="sidebar-link" data-v-40a3448a>删除容器</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#导入和导出容器" class="sidebar-link" data-v-40a3448a>导入和导出容器</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#docker数据管理" class="sidebar-link" data-v-40a3448a>Docker数据管理</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#数据卷" class="sidebar-link" data-v-40a3448a>数据卷</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#创建数据卷" class="sidebar-link" data-v-40a3448a>创建数据卷</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#绑定数据卷" class="sidebar-link" data-v-40a3448a>绑定数据卷</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#数据卷容器" class="sidebar-link" data-v-40a3448a>数据卷容器</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#端口映射与容器互联" class="sidebar-link" data-v-40a3448a>端口映射与容器互联</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#从外部访问容器应用" class="sidebar-link" data-v-40a3448a>从外部访问容器应用</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#容器互联" class="sidebar-link" data-v-40a3448a>容器互联</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#使用dockerfile创建镜像" class="sidebar-link" data-v-40a3448a>使用Dockerfile创建镜像</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#" class="sidebar-link" data-v-40a3448a></a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#常用指令" class="sidebar-link" data-v-40a3448a>常用指令</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#dockerfile构建镜像" class="sidebar-link" data-v-40a3448a>Dockerfile构建镜像</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#docker-网络" class="sidebar-link" data-v-40a3448a>Docker 网络</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#网络模式" class="sidebar-link" data-v-40a3448a>网络模式</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#host模式" class="sidebar-link" data-v-40a3448a>host模式</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#container模式" class="sidebar-link" data-v-40a3448a>container模式</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#none模式" class="sidebar-link" data-v-40a3448a>none模式</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#bridge模式" class="sidebar-link" data-v-40a3448a>bridge模式</a></li><li class="level-3" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#自定义模式" class="sidebar-link" data-v-40a3448a>自定义模式</a></li><li class="level-2" data-v-40a3448a><a href="/views/2021/2020-01-05-docker%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95.html#docker-可视化管理" class="sidebar-link" data-v-40a3448a>Docker 可视化管理</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.98bd2c8c.js" defer></script><script src="/assets/js/4.742ad0b9.js" defer></script><script src="/assets/js/1.65fad08d.js" defer></script><script src="/assets/js/80.b7f0a264.js" defer></script>
  </body>
</html>
